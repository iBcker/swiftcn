<div class="col-md-9 topics-show main-col">

  <!-- Topic Detial -->
  <div class="topic panel panel-default">
    <div class="infos panel-heading">

      <div class="pull-right avatar_large">

        <%= link_to @topic.user do %>
          <%=image_tag(@topic.user.avatar,size: "65", alt: @topic.user.name, class:"img-thumbnail avatar")%>
        <% end %>

      </div>

      <h1 class="panel-title topic-title"><%= @topic.title %></h1>

      <div class="votes">
        <%= link_to up_vote_topic_path, class: "vote" do %>
          <li class="glyphicon glyphicon-thumbs-up"></li> <%= @topic.votes_count %>
        <% end %>
          &nbsp;
        <%= link_to down_vote_topic_path, class: "vote" do %>
          <li class="glyphicon glyphicon-thumbs-down"></li>
        <% end %>
      </div>
      <%= render partial: "meta",locals:{topic:@topic} %>

    </div>

    <div class="content-body entry-content panel-body">
      <%= render partial: "body",locals:{body:@topic.body_original} %>
      <%= render partial: "ribbon",locals:{topic:@topic} %>
    </div>

    <% @topic.appends.each_with_index do |append,index| %>
      <div class="appends">
            <span class="meta"><%= "lang('Append')  #{index}" %> &nbsp;Â·&nbsp; <abbr title="<%= append.created_at %>" class="timeago"><%= distance_of_time_in_words_to_now append.created_at %></abbr></span>
            <div class="sep5"></div>
            <div class="markdown-reply append-content">
                <%= append.content %>
            </div>
        </div>
    <% end %>
    
    <%= render partial: "topic_operate",locals:{topic:@topic} %>

  </div>

  <!-- Reply List -->
  <div class="replies panel panel-default list-panel replies-index">
    <div class="panel-heading">
      <div class="total">{{ lang('Total Reply Count') }}: <b>{{ $replies->getTotal() }}</b> </div>
    </div>

    <div class="panel-body">

      @if (count($replies))
        @include('topics.partials.replies')
      @else
         <div class="empty-block">{{ lang('No comments') }}~~</div>
      @endif

      <!-- Pager -->
      <div class="pull-right" style="padding-right:20px">
        {{ $replies->appends(Request::except('page'))->links(); }}
      </div>
    </div>
  </div>

  <!-- Reply Box -->
  <div class="reply-box form box-block">

    @include('layouts.partials.errors')

    {{ Form::open(['route' => 'replies.store', 'id' => 'reply-form', 'method' => 'post']) }}
      <input type="hidden" name="topic_id" value="{{ $topic->id }}" />

        @include('topics.partials.composing_help_block')

        <div class="form-group">
            @if ($currentUser)
              {{ Form::textarea('body', null, ['class' => 'form-control',
                                                'rows' => 5,
                                                'placeholder' => lang('Please using markdown.'),
                                                'style' => "overflow:hidden",
                                                'id' => 'reply_content']) }}
            @else
              {{ Form::textarea('body', null, ['class' => 'form-control', 'disabled' => 'disabled', 'rows' => 5, 'placeholder' => lang('User Login Required for commenting.')]) }}
            @endif
        </div>

        <div class="form-group status-post-submit">

            @if ($currentUser)
              {{ Form::submit(lang('Reply'), ['class' => 'btn btn-primary', 'id' => 'reply-create-submit']) }}
            @else
              {{ Form::submit(lang('Reply'), ['class' => 'btn btn-primary disabled', 'id' => 'reply-create-submit']) }}
            @endif

            <span class="help-inline hidden-in-mobile" title="Or Command + Enter">Ctrl+Enter</span>
        </div>

        <div class="box preview markdown-reply" id="preview-box" style="display:none;"></div>

    {{ Form::close() }}
  </div>

</div>

@include('layouts.partials.sidebar')

@stop
